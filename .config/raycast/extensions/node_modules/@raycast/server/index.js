"use strict";var Ei=Object.create;var os=Object.defineProperty;var Pi=Object.getOwnPropertyDescriptor;var ji=Object.getOwnPropertyNames;var Ni=Object.getPrototypeOf,Oi=Object.prototype.hasOwnProperty;var U=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ci=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ji(e))!Oi.call(t,s)&&s!==r&&os(t,s,{get:()=>e[s],enumerable:!(n=Pi(e,s))||n.enumerable});return t};var Mi=(t,e,r)=>(r=t!=null?Ei(Ni(t)):{},Ci(e||!t||!t.__esModule?os(r,"default",{value:t,enumerable:!0}):r,t));var Be=U(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.stringArray=J.array=J.func=J.error=J.number=J.string=J.boolean=void 0;function Ai(t){return t===!0||t===!1}J.boolean=Ai;function cs(t){return typeof t=="string"||t instanceof String}J.string=cs;function Ii(t){return typeof t=="number"||t instanceof Number}J.number=Ii;function Li(t){return t instanceof Error}J.error=Li;function qi(t){return typeof t=="function"}J.func=qi;function us(t){return Array.isArray(t)}J.array=us;function $i(t){return us(t)&&t.every(e=>cs(e))}J.stringArray=$i});var Gr=U(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.Message=_.NotificationType9=_.NotificationType8=_.NotificationType7=_.NotificationType6=_.NotificationType5=_.NotificationType4=_.NotificationType3=_.NotificationType2=_.NotificationType1=_.NotificationType0=_.NotificationType=_.RequestType9=_.RequestType8=_.RequestType7=_.RequestType6=_.RequestType5=_.RequestType4=_.RequestType3=_.RequestType2=_.RequestType1=_.RequestType=_.RequestType0=_.AbstractMessageSignature=_.ParameterStructures=_.ResponseError=_.ErrorCodes=void 0;var Me=Be(),Tr;(function(t){t.ParseError=-32700,t.InvalidRequest=-32600,t.MethodNotFound=-32601,t.InvalidParams=-32602,t.InternalError=-32603,t.jsonrpcReservedErrorRangeStart=-32099,t.serverErrorStart=-32099,t.MessageWriteError=-32099,t.MessageReadError=-32098,t.PendingResponseRejected=-32097,t.ConnectionInactive=-32096,t.ServerNotInitialized=-32002,t.UnknownErrorCode=-32001,t.jsonrpcReservedErrorRangeEnd=-32e3,t.serverErrorEnd=-32e3})(Tr||(_.ErrorCodes=Tr={}));var Rr=class t extends Error{constructor(e,r,n){super(r),this.code=Me.number(e)?e:Tr.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,t.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};_.ResponseError=Rr;var K=class t{constructor(e){this.kind=e}static is(e){return e===t.auto||e===t.byName||e===t.byPosition}toString(){return this.kind}};_.ParameterStructures=K;K.auto=new K("auto");K.byPosition=new K("byPosition");K.byName=new K("byName");var L=class{constructor(e,r){this.method=e,this.numberOfParams=r}get parameterStructures(){return K.auto}};_.AbstractMessageSignature=L;var Sr=class extends L{constructor(e){super(e,0)}};_.RequestType0=Sr;var Er=class extends L{constructor(e,r=K.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};_.RequestType=Er;var Pr=class extends L{constructor(e,r=K.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};_.RequestType1=Pr;var jr=class extends L{constructor(e){super(e,2)}};_.RequestType2=jr;var Nr=class extends L{constructor(e){super(e,3)}};_.RequestType3=Nr;var Or=class extends L{constructor(e){super(e,4)}};_.RequestType4=Or;var Cr=class extends L{constructor(e){super(e,5)}};_.RequestType5=Cr;var Mr=class extends L{constructor(e){super(e,6)}};_.RequestType6=Mr;var Ar=class extends L{constructor(e){super(e,7)}};_.RequestType7=Ar;var Ir=class extends L{constructor(e){super(e,8)}};_.RequestType8=Ir;var Lr=class extends L{constructor(e){super(e,9)}};_.RequestType9=Lr;var qr=class extends L{constructor(e,r=K.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};_.NotificationType=qr;var $r=class extends L{constructor(e){super(e,0)}};_.NotificationType0=$r;var Dr=class extends L{constructor(e,r=K.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};_.NotificationType1=Dr;var Zr=class extends L{constructor(e){super(e,2)}};_.NotificationType2=Zr;var Wr=class extends L{constructor(e){super(e,3)}};_.NotificationType3=Wr;var Br=class extends L{constructor(e){super(e,4)}};_.NotificationType4=Br;var Vr=class extends L{constructor(e){super(e,5)}};_.NotificationType5=Vr;var Ur=class extends L{constructor(e){super(e,6)}};_.NotificationType6=Ur;var Hr=class extends L{constructor(e){super(e,7)}};_.NotificationType7=Hr;var Fr=class extends L{constructor(e){super(e,8)}};_.NotificationType8=Fr;var Jr=class extends L{constructor(e){super(e,9)}};_.NotificationType9=Jr;var ds;(function(t){function e(s){let i=s;return i&&Me.string(i.method)&&(Me.string(i.id)||Me.number(i.id))}t.isRequest=e;function r(s){let i=s;return i&&Me.string(i.method)&&s.id===void 0}t.isNotification=r;function n(s){let i=s;return i&&(i.result!==void 0||!!i.error)&&(Me.string(i.id)||Me.number(i.id)||i.id===null)}t.isResponse=n})(ds||(_.Message=ds={}))});var Yr=U(Re=>{"use strict";var ls;Object.defineProperty(Re,"__esModule",{value:!0});Re.LRUCache=Re.LinkedMap=Re.Touch=void 0;var G;(function(t){t.None=0,t.First=1,t.AsOld=t.First,t.Last=2,t.AsNew=t.Last})(G||(Re.Touch=G={}));var Ht=class{constructor(){this[ls]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,r=G.None){let n=this._map.get(e);if(n)return r!==G.None&&this.touch(n,r),n.value}set(e,r,n=G.None){let s=this._map.get(e);if(s)s.value=r,n!==G.None&&this.touch(s,n);else{switch(s={key:e,value:r,next:void 0,previous:void 0},n){case G.None:this.addItemLast(s);break;case G.First:this.addItemFirst(s);break;case G.Last:this.addItemLast(s);break;default:this.addItemLast(s);break}this._map.set(e,s),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let r=this._map.get(e);if(r)return this._map.delete(e),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,r){let n=this._state,s=this._head;for(;s;){if(r?e.bind(r)(s.value,s.key,this):e(s.value,s.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");s=s.next}}keys(){let e=this._state,r=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let s={value:r.key,done:!1};return r=r.next,s}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,r=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let s={value:r.value,done:!1};return r=r.next,s}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,r=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let s={value:[r.key,r.value],done:!1};return r=r.next,s}else return{value:void 0,done:!0}}};return n}[(ls=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._head,n=this.size;for(;r&&n>e;)this._map.delete(r.key),r=r.next,n--;this._head=r,this._size=n,r&&(r.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let r=e.next,n=e.previous;if(!r||!n)throw new Error("Invalid list");r.previous=n,n.next=r}e.next=void 0,e.previous=void 0,this._state++}touch(e,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==G.First&&r!==G.Last)){if(r===G.First){if(e===this._head)return;let n=e.next,s=e.previous;e===this._tail?(s.next=void 0,this._tail=s):(n.previous=s,s.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(r===G.Last){if(e===this._tail)return;let n=e.next,s=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=s,s.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((r,n)=>{e.push([n,r])}),e}fromJSON(e){this.clear();for(let[r,n]of e)this.set(r,n)}};Re.LinkedMap=Ht;var Qr=class extends Ht{constructor(e,r=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,r=G.AsNew){return super.get(e,r)}peek(e){return super.get(e,G.None)}set(e,r){return super.set(e,r,G.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};Re.LRUCache=Qr});var hs=U(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.Disposable=void 0;var fs;(function(t){function e(r){return{dispose:r}}t.create=e})(fs||(Ft.Disposable=fs={}))});var Se=U(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});var Xr;function Kr(){if(Xr===void 0)throw new Error("No runtime abstraction layer installed");return Xr}(function(t){function e(r){if(r===void 0)throw new Error("No runtime abstraction layer provided");Xr=r}t.install=e})(Kr||(Kr={}));en.default=Kr});var Ue=U(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.Emitter=Ve.Event=void 0;var Di=Se(),ps;(function(t){let e={dispose(){}};t.None=function(){return e}})(ps||(Ve.Event=ps={}));var tn=class{add(e,r=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(r),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,r)})}remove(e,r=null){if(!this._callbacks)return;let n=!1;for(let s=0,i=this._callbacks.length;s<i;s++)if(this._callbacks[s]===e)if(this._contexts[s]===r){this._callbacks.splice(s,1),this._contexts.splice(s,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let r=[],n=this._callbacks.slice(0),s=this._contexts.slice(0);for(let i=0,o=n.length;i<o;i++)try{r.push(n[i].apply(s[i],e))}catch(c){(0,Di.default)().console.error(c)}return r}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Jt=class t{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,r,n)=>{this._callbacks||(this._callbacks=new tn),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,r);let s={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,r),s.dispose=t._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(s),s}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};Ve.Emitter=Jt;Jt._noop=function(){}});var Yt=U(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.CancellationTokenSource=He.CancellationToken=void 0;var Zi=Se(),Wi=Be(),rn=Ue(),Gt;(function(t){t.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:rn.Event.None}),t.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:rn.Event.None});function e(r){let n=r;return n&&(n===t.None||n===t.Cancelled||Wi.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}t.is=e})(Gt||(He.CancellationToken=Gt={}));var Bi=Object.freeze(function(t,e){let r=(0,Zi.default)().timer.setTimeout(t.bind(e),0);return{dispose(){r.dispose()}}}),Qt=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Bi:(this._emitter||(this._emitter=new rn.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},nn=class{get token(){return this._token||(this._token=new Qt),this._token}cancel(){this._token?this._token.cancel():this._token=Gt.Cancelled}dispose(){this._token?this._token instanceof Qt&&this._token.dispose():this._token=Gt.None}};He.CancellationTokenSource=nn});var ms=U(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.SharedArrayReceiverStrategy=Fe.SharedArraySenderStrategy=void 0;var Vi=Yt(),bt;(function(t){t.Continue=0,t.Cancelled=1})(bt||(bt={}));var sn=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let r=new SharedArrayBuffer(4),n=new Int32Array(r,0,1);n[0]=bt.Continue,this.buffers.set(e.id,r),e.$cancellationData=r}async sendCancellation(e,r){let n=this.buffers.get(r);if(n===void 0)return;let s=new Int32Array(n,0,1);Atomics.store(s,0,bt.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};Fe.SharedArraySenderStrategy=sn;var an=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===bt.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},on=class{constructor(e){this.token=new an(e)}cancel(){}dispose(){}},cn=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let r=e.$cancellationData;return r===void 0?new Vi.CancellationTokenSource:new on(r)}};Fe.SharedArrayReceiverStrategy=cn});var dn=U(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.Semaphore=void 0;var Ui=Se(),un=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((r,n)=>{this._waiting.push({thunk:e,resolve:r,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Ui.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let r=e.thunk();r instanceof Promise?r.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(r),this.runNext())}catch(r){this._active--,e.reject(r),this.runNext()}}};Xt.Semaphore=un});var ys=U(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.ReadableStreamMessageReader=Ee.AbstractMessageReader=Ee.MessageReader=void 0;var fn=Se(),Je=Be(),ln=Ue(),Hi=dn(),gs;(function(t){function e(r){let n=r;return n&&Je.func(n.listen)&&Je.func(n.dispose)&&Je.func(n.onError)&&Je.func(n.onClose)&&Je.func(n.onPartialMessage)}t.is=e})(gs||(Ee.MessageReader=gs={}));var Kt=class{constructor(){this.errorEmitter=new ln.Emitter,this.closeEmitter=new ln.Emitter,this.partialMessageEmitter=new ln.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${Je.string(e.message)?e.message:"unknown"}`)}};Ee.AbstractMessageReader=Kt;var hn;(function(t){function e(r){let n,s,i,o=new Map,c,h=new Map;if(r===void 0||typeof r=="string")n=r??"utf-8";else{if(n=r.charset??"utf-8",r.contentDecoder!==void 0&&(i=r.contentDecoder,o.set(i.name,i)),r.contentDecoders!==void 0)for(let l of r.contentDecoders)o.set(l.name,l);if(r.contentTypeDecoder!==void 0&&(c=r.contentTypeDecoder,h.set(c.name,c)),r.contentTypeDecoders!==void 0)for(let l of r.contentTypeDecoders)h.set(l.name,l)}return c===void 0&&(c=(0,fn.default)().applicationJson.decoder,h.set(c.name,c)),{charset:n,contentDecoder:i,contentDecoders:o,contentTypeDecoder:c,contentTypeDecoders:h}}t.fromOptions=e})(hn||(hn={}));var pn=class extends Kt{constructor(e,r){super(),this.readable=e,this.options=hn.fromOptions(r),this.buffer=(0,fn.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new Hi.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let r=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),r}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let s=n.get("content-length");if(!s){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let i=parseInt(s);if(isNaN(i)){this.fireError(new Error(`Content-Length value must be a number. Got ${s}`));return}this.nextMessageLength=i}let r=this.buffer.tryReadBody(this.nextMessageLength);if(r===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(r):r,s=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(s)}).catch(n=>{this.fireError(n)})}}catch(r){this.fireError(r)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,fn.default)().timer.setTimeout((e,r)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:r}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};Ee.ReadableStreamMessageReader=pn});var ks=U(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.WriteableStreamMessageWriter=Pe.AbstractMessageWriter=Pe.MessageWriter=void 0;var vs=Se(),_t=Be(),Fi=dn(),bs=Ue(),Ji="Content-Length: ",_s=`\r
`,ws;(function(t){function e(r){let n=r;return n&&_t.func(n.dispose)&&_t.func(n.onClose)&&_t.func(n.onError)&&_t.func(n.write)}t.is=e})(ws||(Pe.MessageWriter=ws={}));var er=class{constructor(){this.errorEmitter=new bs.Emitter,this.closeEmitter=new bs.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,r,n){this.errorEmitter.fire([this.asError(e),r,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${_t.string(e.message)?e.message:"unknown"}`)}};Pe.AbstractMessageWriter=er;var mn;(function(t){function e(r){return r===void 0||typeof r=="string"?{charset:r??"utf-8",contentTypeEncoder:(0,vs.default)().applicationJson.encoder}:{charset:r.charset??"utf-8",contentEncoder:r.contentEncoder,contentTypeEncoder:r.contentTypeEncoder??(0,vs.default)().applicationJson.encoder}}t.fromOptions=e})(mn||(mn={}));var gn=class extends er{constructor(e,r){super(),this.writable=e,this.options=mn.fromOptions(r),this.errorCount=0,this.writeSemaphore=new Fi.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let s=[];return s.push(Ji,n.byteLength.toString(),_s),s.push(_s),this.doWrite(e,s,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,r,n){try{return await this.writable.write(r.join(""),"ascii"),this.writable.write(n)}catch(s){return this.handleError(s,e),Promise.reject(s)}}handleError(e,r){this.errorCount++,this.fireError(e,r,this.errorCount)}end(){this.writable.end()}};Pe.WriteableStreamMessageWriter=gn});var xs=U(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.AbstractMessageBuffer=void 0;var Gi=13,Qi=10,Yi=`\r
`,yn=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let r=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(r),this._totalLength+=r.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let r=0,n=0,s=0,i=0;e:for(;n<this._chunks.length;){let l=this._chunks[n];for(s=0;s<l.length;){switch(l[s]){case Gi:switch(r){case 0:r=1;break;case 2:r=3;break;default:r=0}break;case Qi:switch(r){case 1:r=2;break;case 3:r=4,s++;break e;default:r=0}break;default:r=0}s++}i+=l.byteLength,n++}if(r!==4)return;let o=this._read(i+s),c=new Map,h=this.toString(o,"ascii").split(Yi);if(h.length<2)return c;for(let l=0;l<h.length-2;l++){let y=h[l],M=y.indexOf(":");if(M===-1)throw new Error(`Message header must separate key and value using ':'
${y}`);let Q=y.substr(0,M),F=y.substr(M+1).trim();c.set(e?Q.toLowerCase():Q,F)}return c}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let i=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(i)}if(this._chunks[0].byteLength>e){let i=this._chunks[0],o=this.asNative(i,e);return this._chunks[0]=i.slice(e),this._totalLength-=e,o}let r=this.allocNative(e),n=0,s=0;for(;e>0;){let i=this._chunks[s];if(i.byteLength>e){let o=i.slice(0,e);r.set(o,n),n+=e,this._chunks[s]=i.slice(e),this._totalLength-=e,e-=e}else r.set(i,n),n+=i.byteLength,this._chunks.shift(),this._totalLength-=i.byteLength,e-=i.byteLength}return r}};tr.AbstractMessageBuffer=yn});var Es=U(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.createMessageConnection=z.ConnectionOptions=z.MessageStrategy=z.CancellationStrategy=z.CancellationSenderStrategy=z.CancellationReceiverStrategy=z.RequestCancellationReceiverStrategy=z.IdCancellationReceiverStrategy=z.ConnectionStrategy=z.ConnectionError=z.ConnectionErrors=z.LogTraceNotification=z.SetTraceNotification=z.TraceFormat=z.TraceValues=z.Trace=z.NullLogger=z.ProgressType=z.ProgressToken=void 0;var zs=Se(),D=Be(),w=Gr(),Ts=Yr(),wt=Ue(),vn=Yt(),zt;(function(t){t.type=new w.NotificationType("$/cancelRequest")})(zt||(zt={}));var bn;(function(t){function e(r){return typeof r=="string"||typeof r=="number"}t.is=e})(bn||(z.ProgressToken=bn={}));var kt;(function(t){t.type=new w.NotificationType("$/progress")})(kt||(kt={}));var _n=class{constructor(){}};z.ProgressType=_n;var wn;(function(t){function e(r){return D.func(r)}t.is=e})(wn||(wn={}));z.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var j;(function(t){t[t.Off=0]="Off",t[t.Messages=1]="Messages",t[t.Compact=2]="Compact",t[t.Verbose=3]="Verbose"})(j||(z.Trace=j={}));var Rs;(function(t){t.Off="off",t.Messages="messages",t.Compact="compact",t.Verbose="verbose"})(Rs||(z.TraceValues=Rs={}));(function(t){function e(n){if(!D.string(n))return t.Off;switch(n=n.toLowerCase(),n){case"off":return t.Off;case"messages":return t.Messages;case"compact":return t.Compact;case"verbose":return t.Verbose;default:return t.Off}}t.fromString=e;function r(n){switch(n){case t.Off:return"off";case t.Messages:return"messages";case t.Compact:return"compact";case t.Verbose:return"verbose";default:return"off"}}t.toString=r})(j||(z.Trace=j={}));var re;(function(t){t.Text="text",t.JSON="json"})(re||(z.TraceFormat=re={}));(function(t){function e(r){return D.string(r)?(r=r.toLowerCase(),r==="json"?t.JSON:t.Text):t.Text}t.fromString=e})(re||(z.TraceFormat=re={}));var kn;(function(t){t.type=new w.NotificationType("$/setTrace")})(kn||(z.SetTraceNotification=kn={}));var rr;(function(t){t.type=new w.NotificationType("$/logTrace")})(rr||(z.LogTraceNotification=rr={}));var xt;(function(t){t[t.Closed=1]="Closed",t[t.Disposed=2]="Disposed",t[t.AlreadyListening=3]="AlreadyListening"})(xt||(z.ConnectionErrors=xt={}));var Ge=class t extends Error{constructor(e,r){super(r),this.code=e,Object.setPrototypeOf(this,t.prototype)}};z.ConnectionError=Ge;var xn;(function(t){function e(r){let n=r;return n&&D.func(n.cancelUndispatched)}t.is=e})(xn||(z.ConnectionStrategy=xn={}));var nr;(function(t){function e(r){let n=r;return n&&(n.kind===void 0||n.kind==="id")&&D.func(n.createCancellationTokenSource)&&(n.dispose===void 0||D.func(n.dispose))}t.is=e})(nr||(z.IdCancellationReceiverStrategy=nr={}));var zn;(function(t){function e(r){let n=r;return n&&n.kind==="request"&&D.func(n.createCancellationTokenSource)&&(n.dispose===void 0||D.func(n.dispose))}t.is=e})(zn||(z.RequestCancellationReceiverStrategy=zn={}));var sr;(function(t){t.Message=Object.freeze({createCancellationTokenSource(r){return new vn.CancellationTokenSource}});function e(r){return nr.is(r)||zn.is(r)}t.is=e})(sr||(z.CancellationReceiverStrategy=sr={}));var ir;(function(t){t.Message=Object.freeze({sendCancellation(r,n){return r.sendNotification(zt.type,{id:n})},cleanup(r){}});function e(r){let n=r;return n&&D.func(n.sendCancellation)&&D.func(n.cleanup)}t.is=e})(ir||(z.CancellationSenderStrategy=ir={}));var ar;(function(t){t.Message=Object.freeze({receiver:sr.Message,sender:ir.Message});function e(r){let n=r;return n&&sr.is(n.receiver)&&ir.is(n.sender)}t.is=e})(ar||(z.CancellationStrategy=ar={}));var or;(function(t){function e(r){let n=r;return n&&D.func(n.handleMessage)}t.is=e})(or||(z.MessageStrategy=or={}));var Ss;(function(t){function e(r){let n=r;return n&&(ar.is(n.cancellationStrategy)||xn.is(n.connectionStrategy)||or.is(n.messageStrategy))}t.is=e})(Ss||(z.ConnectionOptions=Ss={}));var le;(function(t){t[t.New=1]="New",t[t.Listening=2]="Listening",t[t.Closed=3]="Closed",t[t.Disposed=4]="Disposed"})(le||(le={}));function Xi(t,e,r,n){let s=r!==void 0?r:z.NullLogger,i=0,o=0,c=0,h="2.0",l,y=new Map,M,Q=new Map,F=new Map,ke,ie=new Ts.LinkedMap,ae=new Map,xe=new Set,te=new Map,N=j.Off,de=re.Text,q,oe=le.New,Ce=new wt.Emitter,gt=new wt.Emitter,Bt=new wt.Emitter,Vt=new wt.Emitter,kr=new wt.Emitter,ze=n&&n.cancellationStrategy?n.cancellationStrategy:ar.Message;function Xn(a){if(a===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+a.toString()}function ui(a){return a===null?"res-unknown-"+(++c).toString():"res-"+a.toString()}function di(){return"not-"+(++o).toString()}function li(a,d){w.Message.isRequest(d)?a.set(Xn(d.id),d):w.Message.isResponse(d)?a.set(ui(d.id),d):a.set(di(),d)}function fi(a){}function Kn(){return oe===le.Listening}function es(){return oe===le.Closed}function De(){return oe===le.Disposed}function ts(){(oe===le.New||oe===le.Listening)&&(oe=le.Closed,gt.fire(void 0))}function hi(a){Ce.fire([a,void 0,void 0])}function pi(a){Ce.fire(a)}t.onClose(ts),t.onError(hi),e.onClose(ts),e.onError(pi);function rs(){ke||ie.size===0||(ke=(0,zs.default)().timer.setImmediate(()=>{ke=void 0,mi()}))}function ns(a){w.Message.isRequest(a)?yi(a):w.Message.isNotification(a)?bi(a):w.Message.isResponse(a)?vi(a):_i(a)}function mi(){if(ie.size===0)return;let a=ie.shift();try{let d=n?.messageStrategy;or.is(d)?d.handleMessage(a,ns):ns(a)}finally{rs()}}let gi=a=>{try{if(w.Message.isNotification(a)&&a.method===zt.type.method){let d=a.params.id,p=Xn(d),v=ie.get(p);if(w.Message.isRequest(v)){let C=n?.connectionStrategy,Z=C&&C.cancelUndispatched?C.cancelUndispatched(v,fi):void 0;if(Z&&(Z.error!==void 0||Z.result!==void 0)){ie.delete(p),te.delete(d),Z.id=v.id,Ut(Z,a.method,Date.now()),e.write(Z).catch(()=>s.error("Sending response for canceled message failed."));return}}let I=te.get(d);if(I!==void 0){I.cancel(),xr(a);return}else xe.add(d)}li(ie,a)}finally{rs()}};function yi(a){if(De())return;function d(E,$,O){let V={jsonrpc:h,id:a.id};E instanceof w.ResponseError?V.error=E.toJson():V.result=E===void 0?null:E,Ut(V,$,O),e.write(V).catch(()=>s.error("Sending response failed."))}function p(E,$,O){let V={jsonrpc:h,id:a.id,error:E.toJson()};Ut(V,$,O),e.write(V).catch(()=>s.error("Sending response failed."))}function v(E,$,O){E===void 0&&(E=null);let V={jsonrpc:h,id:a.id,result:E};Ut(V,$,O),e.write(V).catch(()=>s.error("Sending response failed."))}xi(a);let I=y.get(a.method),C,Z;I&&(C=I.type,Z=I.handler);let W=Date.now();if(Z||l){let E=a.id??String(Date.now()),$=nr.is(ze.receiver)?ze.receiver.createCancellationTokenSource(E):ze.receiver.createCancellationTokenSource(a);a.id!==null&&xe.has(a.id)&&$.cancel(),a.id!==null&&te.set(E,$);try{let O;if(Z)if(a.params===void 0){if(C!==void 0&&C.numberOfParams!==0){p(new w.ResponseError(w.ErrorCodes.InvalidParams,`Request ${a.method} defines ${C.numberOfParams} params but received none.`),a.method,W);return}O=Z($.token)}else if(Array.isArray(a.params)){if(C!==void 0&&C.parameterStructures===w.ParameterStructures.byName){p(new w.ResponseError(w.ErrorCodes.InvalidParams,`Request ${a.method} defines parameters by name but received parameters by position`),a.method,W);return}O=Z(...a.params,$.token)}else{if(C!==void 0&&C.parameterStructures===w.ParameterStructures.byPosition){p(new w.ResponseError(w.ErrorCodes.InvalidParams,`Request ${a.method} defines parameters by position but received parameters by name`),a.method,W);return}O=Z(a.params,$.token)}else l&&(O=l(a.method,a.params,$.token));let V=O;O?V.then?V.then(Y=>{te.delete(E),d(Y,a.method,W)},Y=>{te.delete(E),Y instanceof w.ResponseError?p(Y,a.method,W):Y&&D.string(Y.message)?p(new w.ResponseError(w.ErrorCodes.InternalError,`Request ${a.method} failed with message: ${Y.message}`),a.method,W):p(new w.ResponseError(w.ErrorCodes.InternalError,`Request ${a.method} failed unexpectedly without providing any details.`),a.method,W)}):(te.delete(E),d(O,a.method,W)):(te.delete(E),v(O,a.method,W))}catch(O){te.delete(E),O instanceof w.ResponseError?d(O,a.method,W):O&&D.string(O.message)?p(new w.ResponseError(w.ErrorCodes.InternalError,`Request ${a.method} failed with message: ${O.message}`),a.method,W):p(new w.ResponseError(w.ErrorCodes.InternalError,`Request ${a.method} failed unexpectedly without providing any details.`),a.method,W)}}else p(new w.ResponseError(w.ErrorCodes.MethodNotFound,`Unhandled method ${a.method}`),a.method,W)}function vi(a){if(!De())if(a.id===null)a.error?s.error(`Received response message without id: Error is: 
${JSON.stringify(a.error,void 0,4)}`):s.error("Received response message without id. No further error information provided.");else{let d=a.id,p=ae.get(d);if(zi(a,p),p!==void 0){ae.delete(d);try{if(a.error){let v=a.error;p.reject(new w.ResponseError(v.code,v.message,v.data))}else if(a.result!==void 0)p.resolve(a.result);else throw new Error("Should never happen.")}catch(v){v.message?s.error(`Response handler '${p.method}' failed with message: ${v.message}`):s.error(`Response handler '${p.method}' failed unexpectedly.`)}}}}function bi(a){if(De())return;let d,p;if(a.method===zt.type.method){let v=a.params.id;xe.delete(v),xr(a);return}else{let v=Q.get(a.method);v&&(p=v.handler,d=v.type)}if(p||M)try{if(xr(a),p)if(a.params===void 0)d!==void 0&&d.numberOfParams!==0&&d.parameterStructures!==w.ParameterStructures.byName&&s.error(`Notification ${a.method} defines ${d.numberOfParams} params but received none.`),p();else if(Array.isArray(a.params)){let v=a.params;a.method===kt.type.method&&v.length===2&&bn.is(v[0])?p({token:v[0],value:v[1]}):(d!==void 0&&(d.parameterStructures===w.ParameterStructures.byName&&s.error(`Notification ${a.method} defines parameters by name but received parameters by position`),d.numberOfParams!==a.params.length&&s.error(`Notification ${a.method} defines ${d.numberOfParams} params but received ${v.length} arguments`)),p(...v))}else d!==void 0&&d.parameterStructures===w.ParameterStructures.byPosition&&s.error(`Notification ${a.method} defines parameters by position but received parameters by name`),p(a.params);else M&&M(a.method,a.params)}catch(v){v.message?s.error(`Notification handler '${a.method}' failed with message: ${v.message}`):s.error(`Notification handler '${a.method}' failed unexpectedly.`)}else Bt.fire(a)}function _i(a){if(!a){s.error("Received empty message.");return}s.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(a,null,4)}`);let d=a;if(D.string(d.id)||D.number(d.id)){let p=d.id,v=ae.get(p);v&&v.reject(new Error("The received response has neither a result nor an error property."))}}function Te(a){if(a!=null)switch(N){case j.Verbose:return JSON.stringify(a,null,4);case j.Compact:return JSON.stringify(a);default:return}}function wi(a){if(!(N===j.Off||!q))if(de===re.Text){let d;(N===j.Verbose||N===j.Compact)&&a.params&&(d=`Params: ${Te(a.params)}

`),q.log(`Sending request '${a.method} - (${a.id})'.`,d)}else Ze("send-request",a)}function ki(a){if(!(N===j.Off||!q))if(de===re.Text){let d;(N===j.Verbose||N===j.Compact)&&(a.params?d=`Params: ${Te(a.params)}

`:d=`No parameters provided.

`),q.log(`Sending notification '${a.method}'.`,d)}else Ze("send-notification",a)}function Ut(a,d,p){if(!(N===j.Off||!q))if(de===re.Text){let v;(N===j.Verbose||N===j.Compact)&&(a.error&&a.error.data?v=`Error data: ${Te(a.error.data)}

`:a.result?v=`Result: ${Te(a.result)}

`:a.error===void 0&&(v=`No result returned.

`)),q.log(`Sending response '${d} - (${a.id})'. Processing request took ${Date.now()-p}ms`,v)}else Ze("send-response",a)}function xi(a){if(!(N===j.Off||!q))if(de===re.Text){let d;(N===j.Verbose||N===j.Compact)&&a.params&&(d=`Params: ${Te(a.params)}

`),q.log(`Received request '${a.method} - (${a.id})'.`,d)}else Ze("receive-request",a)}function xr(a){if(!(N===j.Off||!q||a.method===rr.type.method))if(de===re.Text){let d;(N===j.Verbose||N===j.Compact)&&(a.params?d=`Params: ${Te(a.params)}

`:d=`No parameters provided.

`),q.log(`Received notification '${a.method}'.`,d)}else Ze("receive-notification",a)}function zi(a,d){if(!(N===j.Off||!q))if(de===re.Text){let p;if((N===j.Verbose||N===j.Compact)&&(a.error&&a.error.data?p=`Error data: ${Te(a.error.data)}

`:a.result?p=`Result: ${Te(a.result)}

`:a.error===void 0&&(p=`No result returned.

`)),d){let v=a.error?` Request failed: ${a.error.message} (${a.error.code}).`:"";q.log(`Received response '${d.method} - (${a.id})' in ${Date.now()-d.timerStart}ms.${v}`,p)}else q.log(`Received response ${a.id} without active response promise.`,p)}else Ze("receive-response",a)}function Ze(a,d){if(!q||N===j.Off)return;let p={isLSPMessage:!0,type:a,message:d,timestamp:Date.now()};q.log(p)}function yt(){if(es())throw new Ge(xt.Closed,"Connection is closed.");if(De())throw new Ge(xt.Disposed,"Connection is disposed.")}function Ti(){if(Kn())throw new Ge(xt.AlreadyListening,"Connection is already listening")}function Ri(){if(!Kn())throw new Error("Call listen() first.")}function vt(a){return a===void 0?null:a}function ss(a){if(a!==null)return a}function is(a){return a!=null&&!Array.isArray(a)&&typeof a=="object"}function zr(a,d){switch(a){case w.ParameterStructures.auto:return is(d)?ss(d):[vt(d)];case w.ParameterStructures.byName:if(!is(d))throw new Error("Received parameters by name but param is not an object literal.");return ss(d);case w.ParameterStructures.byPosition:return[vt(d)];default:throw new Error(`Unknown parameter structure ${a.toString()}`)}}function as(a,d){let p,v=a.numberOfParams;switch(v){case 0:p=void 0;break;case 1:p=zr(a.parameterStructures,d[0]);break;default:p=[];for(let I=0;I<d.length&&I<v;I++)p.push(vt(d[I]));if(d.length<v)for(let I=d.length;I<v;I++)p.push(null);break}return p}let We={sendNotification:(a,...d)=>{yt();let p,v;if(D.string(a)){p=a;let C=d[0],Z=0,W=w.ParameterStructures.auto;w.ParameterStructures.is(C)&&(Z=1,W=C);let E=d.length,$=E-Z;switch($){case 0:v=void 0;break;case 1:v=zr(W,d[Z]);break;default:if(W===w.ParameterStructures.byName)throw new Error(`Received ${$} parameters for 'by Name' notification parameter structure.`);v=d.slice(Z,E).map(O=>vt(O));break}}else{let C=d;p=a.method,v=as(a,C)}let I={jsonrpc:h,method:p,params:v};return ki(I),e.write(I).catch(C=>{throw s.error("Sending notification failed."),C})},onNotification:(a,d)=>{yt();let p;return D.func(a)?M=a:d&&(D.string(a)?(p=a,Q.set(a,{type:void 0,handler:d})):(p=a.method,Q.set(a.method,{type:a,handler:d}))),{dispose:()=>{p!==void 0?Q.delete(p):M=void 0}}},onProgress:(a,d,p)=>{if(F.has(d))throw new Error(`Progress handler for token ${d} already registered`);return F.set(d,p),{dispose:()=>{F.delete(d)}}},sendProgress:(a,d,p)=>We.sendNotification(kt.type,{token:d,value:p}),onUnhandledProgress:Vt.event,sendRequest:(a,...d)=>{yt(),Ri();let p,v,I;if(D.string(a)){p=a;let E=d[0],$=d[d.length-1],O=0,V=w.ParameterStructures.auto;w.ParameterStructures.is(E)&&(O=1,V=E);let Y=d.length;vn.CancellationToken.is($)&&(Y=Y-1,I=$);let me=Y-O;switch(me){case 0:v=void 0;break;case 1:v=zr(V,d[O]);break;default:if(V===w.ParameterStructures.byName)throw new Error(`Received ${me} parameters for 'by Name' request parameter structure.`);v=d.slice(O,Y).map(Si=>vt(Si));break}}else{let E=d;p=a.method,v=as(a,E);let $=a.numberOfParams;I=vn.CancellationToken.is(E[$])?E[$]:void 0}let C=i++,Z;I&&(Z=I.onCancellationRequested(()=>{let E=ze.sender.sendCancellation(We,C);return E===void 0?(s.log(`Received no promise from cancellation strategy when cancelling id ${C}`),Promise.resolve()):E.catch(()=>{s.log(`Sending cancellation messages for id ${C} failed`)})}));let W={jsonrpc:h,id:C,method:p,params:v};return wi(W),typeof ze.sender.enableCancellation=="function"&&ze.sender.enableCancellation(W),new Promise(async(E,$)=>{let O=me=>{E(me),ze.sender.cleanup(C),Z?.dispose()},V=me=>{$(me),ze.sender.cleanup(C),Z?.dispose()},Y={method:p,timerStart:Date.now(),resolve:O,reject:V};try{ae.set(C,Y),await e.write(W)}catch(me){throw ae.delete(C),Y.reject(new w.ResponseError(w.ErrorCodes.MessageWriteError,me.message?me.message:"Unknown reason")),s.error("Sending request failed."),me}})},onRequest:(a,d)=>{yt();let p=null;return wn.is(a)?(p=void 0,l=a):D.string(a)?(p=null,d!==void 0&&(p=a,y.set(a,{handler:d,type:void 0}))):d!==void 0&&(p=a.method,y.set(a.method,{type:a,handler:d})),{dispose:()=>{p!==null&&(p!==void 0?y.delete(p):l=void 0)}}},hasPendingResponse:()=>ae.size>0,trace:async(a,d,p)=>{let v=!1,I=re.Text;p!==void 0&&(D.boolean(p)?v=p:(v=p.sendNotification||!1,I=p.traceFormat||re.Text)),N=a,de=I,N===j.Off?q=void 0:q=d,v&&!es()&&!De()&&await We.sendNotification(kn.type,{value:j.toString(a)})},onError:Ce.event,onClose:gt.event,onUnhandledNotification:Bt.event,onDispose:kr.event,end:()=>{e.end()},dispose:()=>{if(De())return;oe=le.Disposed,kr.fire(void 0);let a=new w.ResponseError(w.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let d of ae.values())d.reject(a);ae=new Map,te=new Map,xe=new Set,ie=new Ts.LinkedMap,D.func(e.dispose)&&e.dispose(),D.func(t.dispose)&&t.dispose()},listen:()=>{yt(),Ti(),oe=le.Listening,t.listen(gi)},inspect:()=>{(0,zs.default)().console.log("inspect")}};return We.onNotification(rr.type,a=>{if(N===j.Off||!q)return;let d=N===j.Verbose||N===j.Compact;q.log(a.message,d?a.verbose:void 0)}),We.onNotification(kt.type,a=>{let d=F.get(a.token);d?d(a.value):Vt.fire(a)}),We}z.createMessageConnection=Xi});var cr=U(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.ProgressType=u.ProgressToken=u.createMessageConnection=u.NullLogger=u.ConnectionOptions=u.ConnectionStrategy=u.AbstractMessageBuffer=u.WriteableStreamMessageWriter=u.AbstractMessageWriter=u.MessageWriter=u.ReadableStreamMessageReader=u.AbstractMessageReader=u.MessageReader=u.SharedArrayReceiverStrategy=u.SharedArraySenderStrategy=u.CancellationToken=u.CancellationTokenSource=u.Emitter=u.Event=u.Disposable=u.LRUCache=u.Touch=u.LinkedMap=u.ParameterStructures=u.NotificationType9=u.NotificationType8=u.NotificationType7=u.NotificationType6=u.NotificationType5=u.NotificationType4=u.NotificationType3=u.NotificationType2=u.NotificationType1=u.NotificationType0=u.NotificationType=u.ErrorCodes=u.ResponseError=u.RequestType9=u.RequestType8=u.RequestType7=u.RequestType6=u.RequestType5=u.RequestType4=u.RequestType3=u.RequestType2=u.RequestType1=u.RequestType0=u.RequestType=u.Message=u.RAL=void 0;u.MessageStrategy=u.CancellationStrategy=u.CancellationSenderStrategy=u.CancellationReceiverStrategy=u.ConnectionError=u.ConnectionErrors=u.LogTraceNotification=u.SetTraceNotification=u.TraceFormat=u.TraceValues=u.Trace=void 0;var A=Gr();Object.defineProperty(u,"Message",{enumerable:!0,get:function(){return A.Message}});Object.defineProperty(u,"RequestType",{enumerable:!0,get:function(){return A.RequestType}});Object.defineProperty(u,"RequestType0",{enumerable:!0,get:function(){return A.RequestType0}});Object.defineProperty(u,"RequestType1",{enumerable:!0,get:function(){return A.RequestType1}});Object.defineProperty(u,"RequestType2",{enumerable:!0,get:function(){return A.RequestType2}});Object.defineProperty(u,"RequestType3",{enumerable:!0,get:function(){return A.RequestType3}});Object.defineProperty(u,"RequestType4",{enumerable:!0,get:function(){return A.RequestType4}});Object.defineProperty(u,"RequestType5",{enumerable:!0,get:function(){return A.RequestType5}});Object.defineProperty(u,"RequestType6",{enumerable:!0,get:function(){return A.RequestType6}});Object.defineProperty(u,"RequestType7",{enumerable:!0,get:function(){return A.RequestType7}});Object.defineProperty(u,"RequestType8",{enumerable:!0,get:function(){return A.RequestType8}});Object.defineProperty(u,"RequestType9",{enumerable:!0,get:function(){return A.RequestType9}});Object.defineProperty(u,"ResponseError",{enumerable:!0,get:function(){return A.ResponseError}});Object.defineProperty(u,"ErrorCodes",{enumerable:!0,get:function(){return A.ErrorCodes}});Object.defineProperty(u,"NotificationType",{enumerable:!0,get:function(){return A.NotificationType}});Object.defineProperty(u,"NotificationType0",{enumerable:!0,get:function(){return A.NotificationType0}});Object.defineProperty(u,"NotificationType1",{enumerable:!0,get:function(){return A.NotificationType1}});Object.defineProperty(u,"NotificationType2",{enumerable:!0,get:function(){return A.NotificationType2}});Object.defineProperty(u,"NotificationType3",{enumerable:!0,get:function(){return A.NotificationType3}});Object.defineProperty(u,"NotificationType4",{enumerable:!0,get:function(){return A.NotificationType4}});Object.defineProperty(u,"NotificationType5",{enumerable:!0,get:function(){return A.NotificationType5}});Object.defineProperty(u,"NotificationType6",{enumerable:!0,get:function(){return A.NotificationType6}});Object.defineProperty(u,"NotificationType7",{enumerable:!0,get:function(){return A.NotificationType7}});Object.defineProperty(u,"NotificationType8",{enumerable:!0,get:function(){return A.NotificationType8}});Object.defineProperty(u,"NotificationType9",{enumerable:!0,get:function(){return A.NotificationType9}});Object.defineProperty(u,"ParameterStructures",{enumerable:!0,get:function(){return A.ParameterStructures}});var Tn=Yr();Object.defineProperty(u,"LinkedMap",{enumerable:!0,get:function(){return Tn.LinkedMap}});Object.defineProperty(u,"LRUCache",{enumerable:!0,get:function(){return Tn.LRUCache}});Object.defineProperty(u,"Touch",{enumerable:!0,get:function(){return Tn.Touch}});var Ki=hs();Object.defineProperty(u,"Disposable",{enumerable:!0,get:function(){return Ki.Disposable}});var Ps=Ue();Object.defineProperty(u,"Event",{enumerable:!0,get:function(){return Ps.Event}});Object.defineProperty(u,"Emitter",{enumerable:!0,get:function(){return Ps.Emitter}});var js=Yt();Object.defineProperty(u,"CancellationTokenSource",{enumerable:!0,get:function(){return js.CancellationTokenSource}});Object.defineProperty(u,"CancellationToken",{enumerable:!0,get:function(){return js.CancellationToken}});var Ns=ms();Object.defineProperty(u,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return Ns.SharedArraySenderStrategy}});Object.defineProperty(u,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return Ns.SharedArrayReceiverStrategy}});var Rn=ys();Object.defineProperty(u,"MessageReader",{enumerable:!0,get:function(){return Rn.MessageReader}});Object.defineProperty(u,"AbstractMessageReader",{enumerable:!0,get:function(){return Rn.AbstractMessageReader}});Object.defineProperty(u,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Rn.ReadableStreamMessageReader}});var Sn=ks();Object.defineProperty(u,"MessageWriter",{enumerable:!0,get:function(){return Sn.MessageWriter}});Object.defineProperty(u,"AbstractMessageWriter",{enumerable:!0,get:function(){return Sn.AbstractMessageWriter}});Object.defineProperty(u,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Sn.WriteableStreamMessageWriter}});var ea=xs();Object.defineProperty(u,"AbstractMessageBuffer",{enumerable:!0,get:function(){return ea.AbstractMessageBuffer}});var H=Es();Object.defineProperty(u,"ConnectionStrategy",{enumerable:!0,get:function(){return H.ConnectionStrategy}});Object.defineProperty(u,"ConnectionOptions",{enumerable:!0,get:function(){return H.ConnectionOptions}});Object.defineProperty(u,"NullLogger",{enumerable:!0,get:function(){return H.NullLogger}});Object.defineProperty(u,"createMessageConnection",{enumerable:!0,get:function(){return H.createMessageConnection}});Object.defineProperty(u,"ProgressToken",{enumerable:!0,get:function(){return H.ProgressToken}});Object.defineProperty(u,"ProgressType",{enumerable:!0,get:function(){return H.ProgressType}});Object.defineProperty(u,"Trace",{enumerable:!0,get:function(){return H.Trace}});Object.defineProperty(u,"TraceValues",{enumerable:!0,get:function(){return H.TraceValues}});Object.defineProperty(u,"TraceFormat",{enumerable:!0,get:function(){return H.TraceFormat}});Object.defineProperty(u,"SetTraceNotification",{enumerable:!0,get:function(){return H.SetTraceNotification}});Object.defineProperty(u,"LogTraceNotification",{enumerable:!0,get:function(){return H.LogTraceNotification}});Object.defineProperty(u,"ConnectionErrors",{enumerable:!0,get:function(){return H.ConnectionErrors}});Object.defineProperty(u,"ConnectionError",{enumerable:!0,get:function(){return H.ConnectionError}});Object.defineProperty(u,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return H.CancellationReceiverStrategy}});Object.defineProperty(u,"CancellationSenderStrategy",{enumerable:!0,get:function(){return H.CancellationSenderStrategy}});Object.defineProperty(u,"CancellationStrategy",{enumerable:!0,get:function(){return H.CancellationStrategy}});Object.defineProperty(u,"MessageStrategy",{enumerable:!0,get:function(){return H.MessageStrategy}});var ta=Se();u.RAL=ta.default});var Ms=U(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});var Os=require("util"),ye=cr(),ur=class t extends ye.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return t.emptyBuffer}fromString(e,r){return Buffer.from(e,r)}toString(e,r){return e instanceof Buffer?e.toString(r):new Os.TextDecoder(r).decode(e)}asNative(e,r){return r===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,r):Buffer.from(e,0,r)}allocNative(e){return Buffer.allocUnsafe(e)}};ur.emptyBuffer=Buffer.allocUnsafe(0);var En=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),ye.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),ye.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),ye.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),ye.Disposable.create(()=>this.stream.off("data",e))}},Pn=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),ye.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),ye.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),ye.Disposable.create(()=>this.stream.off("end",e))}write(e,r){return new Promise((n,s)=>{let i=o=>{o==null?n():s(o)};typeof e=="string"?this.stream.write(e,r,i):this.stream.write(e,i)})}end(){this.stream.end()}},Cs=Object.freeze({messageBuffer:Object.freeze({create:t=>new ur(t)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(t,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(t,void 0,0),e.charset))}catch(r){return Promise.reject(r)}}}),decoder:Object.freeze({name:"application/json",decode:(t,e)=>{try{return t instanceof Buffer?Promise.resolve(JSON.parse(t.toString(e.charset))):Promise.resolve(JSON.parse(new Os.TextDecoder(e.charset).decode(t)))}catch(r){return Promise.reject(r)}}})}),stream:Object.freeze({asReadableStream:t=>new En(t),asWritableStream:t=>new Pn(t)}),console,timer:Object.freeze({setTimeout(t,e,...r){let n=setTimeout(t,e,...r);return{dispose:()=>clearTimeout(n)}},setImmediate(t,...e){let r=setImmediate(t,...e);return{dispose:()=>clearImmediate(r)}},setInterval(t,e,...r){let n=setInterval(t,e,...r);return{dispose:()=>clearInterval(n)}}})});function jn(){return Cs}(function(t){function e(){ye.RAL.install(Cs)}t.install=e})(jn||(jn={}));Nn.default=jn});var Ls=U(S=>{"use strict";var ra=S&&S.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),na=S&&S.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ra(e,t,r)};Object.defineProperty(S,"__esModule",{value:!0});S.createMessageConnection=S.createServerSocketTransport=S.createClientSocketTransport=S.createServerPipeTransport=S.createClientPipeTransport=S.generateRandomPipeName=S.StreamMessageWriter=S.StreamMessageReader=S.SocketMessageWriter=S.SocketMessageReader=S.PortMessageWriter=S.PortMessageReader=S.IPCMessageWriter=S.IPCMessageReader=void 0;var Qe=Ms();Qe.default.install();var As=require("path"),sa=require("os"),ia=require("crypto"),fr=require("net"),ne=cr();na(cr(),S);var On=class extends ne.AbstractMessageReader{constructor(e){super(),this.process=e;let r=this.process;r.on("error",n=>this.fireError(n)),r.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),ne.Disposable.create(()=>this.process.off("message",e))}};S.IPCMessageReader=On;var Cn=class extends ne.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let r=this.process;r.on("error",n=>this.fireError(n)),r.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,r=>{r?(this.errorCount++,this.handleError(r,e)):this.errorCount=0}),Promise.resolve()}catch(r){return this.handleError(r,e),Promise.reject(r)}}handleError(e,r){this.errorCount++,this.fireError(e,r,this.errorCount)}end(){}};S.IPCMessageWriter=Cn;var Mn=class extends ne.AbstractMessageReader{constructor(e){super(),this.onData=new ne.Emitter,e.on("close",()=>this.fireClose),e.on("error",r=>this.fireError(r)),e.on("message",r=>{this.onData.fire(r)})}listen(e){return this.onData.event(e)}};S.PortMessageReader=Mn;var An=class extends ne.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",r=>this.fireError(r))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(r){return this.handleError(r,e),Promise.reject(r)}}handleError(e,r){this.errorCount++,this.fireError(e,r,this.errorCount)}end(){}};S.PortMessageWriter=An;var Ae=class extends ne.ReadableStreamMessageReader{constructor(e,r="utf-8"){super((0,Qe.default)().stream.asReadableStream(e),r)}};S.SocketMessageReader=Ae;var Ie=class extends ne.WriteableStreamMessageWriter{constructor(e,r){super((0,Qe.default)().stream.asWritableStream(e),r),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};S.SocketMessageWriter=Ie;var dr=class extends ne.ReadableStreamMessageReader{constructor(e,r){super((0,Qe.default)().stream.asReadableStream(e),r)}};S.StreamMessageReader=dr;var lr=class extends ne.WriteableStreamMessageWriter{constructor(e,r){super((0,Qe.default)().stream.asWritableStream(e),r)}};S.StreamMessageWriter=lr;var Is=process.env.XDG_RUNTIME_DIR,aa=new Map([["linux",107],["darwin",103]]);function oa(){let t=(0,ia.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${t}-sock`;let e;Is?e=As.join(Is,`vscode-ipc-${t}.sock`):e=As.join(sa.tmpdir(),`vscode-${t}.sock`);let r=aa.get(process.platform);return r!==void 0&&e.length>r&&(0,Qe.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${r} characters.`),e}S.generateRandomPipeName=oa;function ca(t,e="utf-8"){let r,n=new Promise((s,i)=>{r=s});return new Promise((s,i)=>{let o=(0,fr.createServer)(c=>{o.close(),r([new Ae(c,e),new Ie(c,e)])});o.on("error",i),o.listen(t,()=>{o.removeListener("error",i),s({onConnected:()=>n})})})}S.createClientPipeTransport=ca;function ua(t,e="utf-8"){let r=(0,fr.createConnection)(t);return[new Ae(r,e),new Ie(r,e)]}S.createServerPipeTransport=ua;function da(t,e="utf-8"){let r,n=new Promise((s,i)=>{r=s});return new Promise((s,i)=>{let o=(0,fr.createServer)(c=>{o.close(),r([new Ae(c,e),new Ie(c,e)])});o.on("error",i),o.listen(t,"127.0.0.1",()=>{o.removeListener("error",i),s({onConnected:()=>n})})})}S.createClientSocketTransport=da;function la(t,e="utf-8"){let r=(0,fr.createConnection)(t,"127.0.0.1");return[new Ae(r,e),new Ie(r,e)]}S.createServerSocketTransport=la;function fa(t){let e=t;return e.read!==void 0&&e.addListener!==void 0}function ha(t){let e=t;return e.write!==void 0&&e.addListener!==void 0}function pa(t,e,r,n){r||(r=ne.NullLogger);let s=fa(t)?new dr(t):t,i=ha(e)?new lr(e):e;return ne.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,ne.createMessageConnection)(s,i,r,n)}S.createMessageConnection=pa});var $s=U((ho,qs)=>{"use strict";qs.exports=Ls()});var oi=require("util");var pt=Mi($s());var Ds=require("node:worker_threads");var B=class t extends Error{underlying;get name(){return this.underlying instanceof Error?this.underlying.name:typeof this.underlying=="string"||this.underlying instanceof String?`${this.underlying}`:JSON.stringify(this.underlying)}code;title;breadcrumbs;diagnostics;sessionId;constructor(e,r,n,s){e&&typeof e=="object"&&"message"in e&&typeof e.message=="string"?super(e.message):s?.message?super(s?.message):typeof e=="string"?super(e):super(),this.underlying=e,this.code=r,this.title=n,this.stack=e instanceof Error?e.stack:s?.stack,this.breadcrumbs=s?.breadcrumbs,this.diagnostics=s?.diagnostics,this.sessionId=s?.sessionId??Ds.workerData?.sessionId}serialize(){return{_isRayError:!0,code:this.code,title:this.title,name:this.name,message:this.message,stack:this.stack,breadcrumbs:this.breadcrumbs,diagnostics:this.diagnostics,sessionId:this.sessionId}}static tryDeserialize(e){if(!t.isRecord(e)||!t.hasProperty(e,"_isRayError")||!e._isRayError||Array.isArray(e)||!t.hasProperty(e,"code")||typeof e.code!="number"||!t.hasProperty(e,"title")||typeof e.title!="string"||!t.hasProperty(e,"name")||typeof e.name!="string")return null;let r=t.hasProperty(e,"message")&&typeof e.message=="string"?e.message:void 0,n=t.hasProperty(e,"stack")&&typeof e.stack=="string"?e.stack:void 0,s=t.hasProperty(e,"breadcrumbs")&&Array.isArray(e.breadcrumbs)?e.breadcrumbs:void 0,i=t.hasProperty(e,"diagnostics")&&typeof e.diagnostics=="object"?e.diagnostics:void 0,o=t.hasProperty(e,"sessionId")&&typeof e.sessionId=="string"?e.sessionId:void 0;return new t(e.name,e.code,e.title,{message:r,stack:n,breadcrumbs:s,diagnostics:i,sessionId:o})}static hasProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)&&typeof e[r]<"u"&&e[r]!==null}static isRecord(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}};var P;(function(t){t.assertEqual=s=>s;function e(s){}t.assertIs=e;function r(s){throw new Error}t.assertNever=r,t.arrayToEnum=s=>{let i={};for(let o of s)i[o]=o;return i},t.getValidEnumValues=s=>{let i=t.objectKeys(s).filter(c=>typeof s[s[c]]!="number"),o={};for(let c of i)o[c]=s[c];return t.objectValues(o)},t.objectValues=s=>t.objectKeys(s).map(function(i){return s[i]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},t.find=(s,i)=>{for(let o of s)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=n,t.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(P||(P={}));var Zs;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Zs||(Zs={}));var g=P.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),je=t=>{switch(typeof t){case"undefined":return g.undefined;case"string":return g.string;case"number":return isNaN(t)?g.nan:g.number;case"boolean":return g.boolean;case"function":return g.function;case"bigint":return g.bigint;case"symbol":return g.symbol;case"object":return Array.isArray(t)?g.array:t===null?g.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?g.promise:typeof Map<"u"&&t instanceof Map?g.map:typeof Set<"u"&&t instanceof Set?g.set:typeof Date<"u"&&t instanceof Date?g.date:g.object;default:return g.unknown}},f=P.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var ce=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)n._errors.push(r(o));else{let c=n,h=0;for(;h<o.path.length;){let l=o.path[h];h===o.path.length-1?(c[l]=c[l]||{_errors:[]},c[l]._errors.push(r(o))):c[l]=c[l]||{_errors:[]},c=c[l],h++}}};return s(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,P.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let s of this.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};ce.create=t=>new ce(t);var Et=(t,e)=>{let r;switch(t.code){case f.invalid_type:t.received===g.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case f.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,P.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:r=`Unrecognized key(s) in object: ${P.joinValues(t.keys,", ")}`;break;case f.invalid_union:r="Invalid input";break;case f.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${P.joinValues(t.options)}`;break;case f.invalid_enum_value:r=`Invalid enum value. Expected ${P.joinValues(t.options)}, received '${t.received}'`;break;case f.invalid_arguments:r="Invalid function arguments";break;case f.invalid_return_type:r="Invalid function return type";break;case f.invalid_date:r="Invalid date";break;case f.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:P.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case f.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case f.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case f.custom:r="Invalid input";break;case f.invalid_intersection_types:r="Intersection results could not be merged";break;case f.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case f.not_finite:r="Number must be finite";break;default:r=e.defaultError,P.assertNever(t)}return{message:r}},ma=Et;function Ln(){return ma}var qn=t=>{let{data:e,path:r,errorMaps:n,issueData:s}=t,i=[...r,...s.path||[]],o={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let c="",h=n.filter(l=>!!l).slice().reverse();for(let l of h)c=l(o,{data:e,defaultError:c}).message;return{...s,path:i,message:c}};function m(t,e){let r=Ln(),n=qn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Et?void 0:Et].filter(s=>!!s)});t.common.issues.push(n)}var X=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let s of r){if(s.status==="aborted")return x;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let s of r){let i=await s.key,o=await s.value;n.push({key:i,value:o})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let s of r){let{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return x;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(n[i.value]=o.value)}return{status:e.value,value:n}}},x=Object.freeze({status:"aborted"}),Tt=t=>({status:"dirty",value:t}),ee=t=>({status:"valid",value:t}),Ws=t=>t.status==="aborted",Bs=t=>t.status==="dirty",Xe=t=>t.status==="valid",hr=t=>typeof Promise<"u"&&t instanceof Promise;function pr(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function Us(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r}var b;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(b||(b={}));var Rt,St,ue=class{constructor(e,r,n,s){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Vs=(t,e)=>{if(Xe(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new ce(t.common.issues);return this._error=r,this._error}}};function T(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:s}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,c)=>{var h,l;let{message:y}=t;return o.code==="invalid_enum_value"?{message:y??c.defaultError}:typeof c.data>"u"?{message:(h=y??n)!==null&&h!==void 0?h:c.defaultError}:o.code!=="invalid_type"?{message:c.defaultError}:{message:(l=y??r)!==null&&l!==void 0?l:c.defaultError}},description:s}}var R=class{get description(){return this._def.description}_getType(e){return je(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new X,ctx:{common:e.parent.common,data:e.data,parsedType:je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(hr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let s={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)},i=this._parseSync({data:e,path:s.path,parent:s});return Vs(s,i)}"~validate"(e){var r,n;let s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:s});return Xe(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((n=(r=i?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>Xe(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(hr(s)?s:Promise.resolve(s));return Vs(n,i)}refine(e,r){let n=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,i)=>{let o=e(s),c=()=>i.addIssue({code:f.custom,...n(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(h=>h?!0:(c(),!1)):o?!0:(c(),!1)})}refinement(e,r){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof r=="function"?r(n,s):r),!1))}_refinement(e){return new he({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return fe.create(this,this._def)}nullable(){return _e.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Oe.create(this)}promise(){return Le.create(this,this._def)}or(e){return rt.create([this,e],this._def)}and(e){return nt.create(this,e,this._def)}transform(e){return new he({...T(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new ct({...T(this._def),innerType:this,defaultValue:r,typeName:k.ZodDefault})}brand(){return new mr({typeName:k.ZodBranded,type:this,...T(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new ut({...T(this._def),innerType:this,catchValue:r,typeName:k.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return gr.create(this,e)}readonly(){return dt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},ga=/^c[^\s-]{8,}$/i,ya=/^[0-9a-z]+$/,va=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ba=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_a=/^[a-z0-9_-]{21}$/i,wa=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ka=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,xa=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,za="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",In,Ta=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ra=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Sa=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ea=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Pa=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ja=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Hs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Na=new RegExp(`^${Hs}$`);function Fs(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Oa(t){return new RegExp(`^${Fs(t)}$`)}function Ca(t){let e=`${Hs}T${Fs(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Ma(t,e){return!!((e==="v4"||!e)&&Ta.test(t)||(e==="v6"||!e)&&Sa.test(t))}function Aa(t,e){if(!wa.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function Ia(t,e){return!!((e==="v4"||!e)&&Ra.test(t)||(e==="v6"||!e)&&Ea.test(t))}var Ke=class t extends R{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==g.string){let i=this._getOrReturnCtx(e);return m(i,{code:f.invalid_type,expected:g.string,received:i.parsedType}),x}let n=new X,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),m(s,{code:f.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),m(s,{code:f.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,c=e.data.length<i.value;(o||c)&&(s=this._getOrReturnCtx(e,s),o?m(s,{code:f.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&m(s,{code:f.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")xa.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"email",code:f.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")In||(In=new RegExp(za,"u")),In.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"emoji",code:f.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")ba.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"uuid",code:f.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")_a.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"nanoid",code:f.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")ga.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"cuid",code:f.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")ya.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"cuid2",code:f.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")va.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"ulid",code:f.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),m(s,{validation:"url",code:f.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"regex",code:f.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),m(s,{code:f.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),m(s,{code:f.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),m(s,{code:f.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?Ca(i).test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{code:f.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?Na.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{code:f.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Oa(i).test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{code:f.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?ka.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"duration",code:f.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?Ma(e.data,i.version)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"ip",code:f.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?Aa(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"jwt",code:f.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?Ia(e.data,i.version)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"cidr",code:f.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Pa.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"base64",code:f.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?ja.test(e.data)||(s=this._getOrReturnCtx(e,s),m(s,{validation:"base64url",code:f.invalid_string,message:i.message}),n.dirty()):P.assertNever(i);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(s=>e.test(s),{validation:r,code:f.invalid_string,...b.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...b.errToObj(e)})}url(e){return this._addCheck({kind:"url",...b.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...b.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...b.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...b.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...b.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...b.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...b.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...b.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...b.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...b.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...b.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...b.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...b.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...b.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...b.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...b.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...b.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...b.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...b.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...b.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...b.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...b.errToObj(r)})}nonempty(e){return this.min(1,b.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Ke.create=t=>{var e;return new Ke({checks:[],typeName:k.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...T(t)})};function La(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=r>n?r:n,i=parseInt(t.toFixed(s).replace(".","")),o=parseInt(e.toFixed(s).replace(".",""));return i%o/Math.pow(10,s)}var Pt=class t extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==g.number){let i=this._getOrReturnCtx(e);return m(i,{code:f.invalid_type,expected:g.number,received:i.parsedType}),x}let n,s=new X;for(let i of this._def.checks)i.kind==="int"?P.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),m(n,{code:f.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),m(n,{code:f.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),m(n,{code:f.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?La(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),m(n,{code:f.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),m(n,{code:f.not_finite,message:i.message}),s.dirty()):P.assertNever(i);return{status:s.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,b.toString(r))}gt(e,r){return this.setLimit("min",e,!1,b.toString(r))}lte(e,r){return this.setLimit("max",e,!0,b.toString(r))}lt(e,r){return this.setLimit("max",e,!1,b.toString(r))}setLimit(e,r,n,s){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:b.toString(s)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:b.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:b.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:b.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:b.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:b.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&P.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Pt.create=t=>new Pt({checks:[],typeName:k.ZodNumber,coerce:t?.coerce||!1,...T(t)});var jt=class t extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==g.bigint)return this._getInvalidInput(e);let n,s=new X;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),m(n,{code:f.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),m(n,{code:f.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),m(n,{code:f.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):P.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return m(r,{code:f.invalid_type,expected:g.bigint,received:r.parsedType}),x}gte(e,r){return this.setLimit("min",e,!0,b.toString(r))}gt(e,r){return this.setLimit("min",e,!1,b.toString(r))}lte(e,r){return this.setLimit("max",e,!0,b.toString(r))}lt(e,r){return this.setLimit("max",e,!1,b.toString(r))}setLimit(e,r,n,s){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:b.toString(s)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:b.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};jt.create=t=>{var e;return new jt({checks:[],typeName:k.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...T(t)})};var Nt=class extends R{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==g.boolean){let n=this._getOrReturnCtx(e);return m(n,{code:f.invalid_type,expected:g.boolean,received:n.parsedType}),x}return ee(e.data)}};Nt.create=t=>new Nt({typeName:k.ZodBoolean,coerce:t?.coerce||!1,...T(t)});var Ot=class t extends R{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==g.date){let i=this._getOrReturnCtx(e);return m(i,{code:f.invalid_type,expected:g.date,received:i.parsedType}),x}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return m(i,{code:f.invalid_date}),x}let n=new X,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),m(s,{code:f.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),m(s,{code:f.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):P.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:b.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:b.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Ot.create=t=>new Ot({checks:[],coerce:t?.coerce||!1,typeName:k.ZodDate,...T(t)});var Ct=class extends R{_parse(e){if(this._getType(e)!==g.symbol){let n=this._getOrReturnCtx(e);return m(n,{code:f.invalid_type,expected:g.symbol,received:n.parsedType}),x}return ee(e.data)}};Ct.create=t=>new Ct({typeName:k.ZodSymbol,...T(t)});var et=class extends R{_parse(e){if(this._getType(e)!==g.undefined){let n=this._getOrReturnCtx(e);return m(n,{code:f.invalid_type,expected:g.undefined,received:n.parsedType}),x}return ee(e.data)}};et.create=t=>new et({typeName:k.ZodUndefined,...T(t)});var tt=class extends R{_parse(e){if(this._getType(e)!==g.null){let n=this._getOrReturnCtx(e);return m(n,{code:f.invalid_type,expected:g.null,received:n.parsedType}),x}return ee(e.data)}};tt.create=t=>new tt({typeName:k.ZodNull,...T(t)});var Mt=class extends R{constructor(){super(...arguments),this._any=!0}_parse(e){return ee(e.data)}};Mt.create=t=>new Mt({typeName:k.ZodAny,...T(t)});var Ne=class extends R{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ee(e.data)}};Ne.create=t=>new Ne({typeName:k.ZodUnknown,...T(t)});var ge=class extends R{_parse(e){let r=this._getOrReturnCtx(e);return m(r,{code:f.invalid_type,expected:g.never,received:r.parsedType}),x}};ge.create=t=>new ge({typeName:k.ZodNever,...T(t)});var At=class extends R{_parse(e){if(this._getType(e)!==g.undefined){let n=this._getOrReturnCtx(e);return m(n,{code:f.invalid_type,expected:g.void,received:n.parsedType}),x}return ee(e.data)}};At.create=t=>new At({typeName:k.ZodVoid,...T(t)});var Oe=class t extends R{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),s=this._def;if(r.parsedType!==g.array)return m(r,{code:f.invalid_type,expected:g.array,received:r.parsedType}),x;if(s.exactLength!==null){let o=r.data.length>s.exactLength.value,c=r.data.length<s.exactLength.value;(o||c)&&(m(r,{code:o?f.too_big:f.too_small,minimum:c?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(m(r,{code:f.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(m(r,{code:f.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((o,c)=>s.type._parseAsync(new ue(r,o,r.path,c)))).then(o=>X.mergeArray(n,o));let i=[...r.data].map((o,c)=>s.type._parseSync(new ue(r,o,r.path,c)));return X.mergeArray(n,i)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:b.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:b.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:b.toString(r)}})}nonempty(e){return this.min(1,e)}};Oe.create=(t,e)=>new Oe({type:t,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...T(e)});function Ye(t){if(t instanceof se){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=fe.create(Ye(n))}return new se({...t._def,shape:()=>e})}else return t instanceof Oe?new Oe({...t._def,type:Ye(t.element)}):t instanceof fe?fe.create(Ye(t.unwrap())):t instanceof _e?_e.create(Ye(t.unwrap())):t instanceof be?be.create(t.items.map(e=>Ye(e))):t}var se=class t extends R{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=P.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==g.object){let l=this._getOrReturnCtx(e);return m(l,{code:f.invalid_type,expected:g.object,received:l.parsedType}),x}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),c=[];if(!(this._def.catchall instanceof ge&&this._def.unknownKeys==="strip"))for(let l in s.data)o.includes(l)||c.push(l);let h=[];for(let l of o){let y=i[l],M=s.data[l];h.push({key:{status:"valid",value:l},value:y._parse(new ue(s,M,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof ge){let l=this._def.unknownKeys;if(l==="passthrough")for(let y of c)h.push({key:{status:"valid",value:y},value:{status:"valid",value:s.data[y]}});else if(l==="strict")c.length>0&&(m(s,{code:f.unrecognized_keys,keys:c}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let y of c){let M=s.data[y];h.push({key:{status:"valid",value:y},value:l._parse(new ue(s,M,s.path,y)),alwaysSet:y in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let l=[];for(let y of h){let M=await y.key,Q=await y.value;l.push({key:M,value:Q,alwaysSet:y.alwaysSet})}return l}).then(l=>X.mergeObjectSync(n,l)):X.mergeObjectSync(n,h)}get shape(){return this._def.shape()}strict(e){return b.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var s,i,o,c;let h=(o=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,r,n).message)!==null&&o!==void 0?o:n.defaultError;return r.code==="unrecognized_keys"?{message:(c=b.errToObj(e).message)!==null&&c!==void 0?c:h}:{message:h}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};return P.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}omit(e){let r={};return P.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}deepPartial(){return Ye(this)}partial(e){let r={};return P.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];e&&!e[n]?r[n]=s:r[n]=s.optional()}),new t({...this._def,shape:()=>r})}required(e){let r={};return P.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof fe;)i=i._def.innerType;r[n]=i}}),new t({...this._def,shape:()=>r})}keyof(){return Js(P.objectKeys(this.shape))}};se.create=(t,e)=>new se({shape:()=>t,unknownKeys:"strip",catchall:ge.create(),typeName:k.ZodObject,...T(e)});se.strictCreate=(t,e)=>new se({shape:()=>t,unknownKeys:"strict",catchall:ge.create(),typeName:k.ZodObject,...T(e)});se.lazycreate=(t,e)=>new se({shape:t,unknownKeys:"strip",catchall:ge.create(),typeName:k.ZodObject,...T(e)});var rt=class extends R{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function s(i){for(let c of i)if(c.result.status==="valid")return c.result;for(let c of i)if(c.result.status==="dirty")return r.common.issues.push(...c.ctx.common.issues),c.result;let o=i.map(c=>new ce(c.ctx.common.issues));return m(r,{code:f.invalid_union,unionErrors:o}),x}if(r.common.async)return Promise.all(n.map(async i=>{let o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(s);{let i,o=[];for(let h of n){let l={...r,common:{...r.common,issues:[]},parent:null},y=h._parseSync({data:r.data,path:r.path,parent:l});if(y.status==="valid")return y;y.status==="dirty"&&!i&&(i={result:y,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;let c=o.map(h=>new ce(h));return m(r,{code:f.invalid_union,unionErrors:c}),x}}get options(){return this._def.options}};rt.create=(t,e)=>new rt({options:t,typeName:k.ZodUnion,...T(e)});var ve=t=>t instanceof st?ve(t.schema):t instanceof he?ve(t.innerType()):t instanceof it?[t.value]:t instanceof at?t.options:t instanceof ot?P.objectValues(t.enum):t instanceof ct?ve(t._def.innerType):t instanceof et?[void 0]:t instanceof tt?[null]:t instanceof fe?[void 0,...ve(t.unwrap())]:t instanceof _e?[null,...ve(t.unwrap())]:t instanceof mr||t instanceof dt?ve(t.unwrap()):t instanceof ut?ve(t._def.innerType):[],$n=class t extends R{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==g.object)return m(r,{code:f.invalid_type,expected:g.object,received:r.parsedType}),x;let n=this.discriminator,s=r.data[n],i=this.optionsMap.get(s);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(m(r,{code:f.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),x)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let s=new Map;for(let i of r){let o=ve(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let c of o){if(s.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);s.set(c,i)}}return new t({typeName:k.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:s,...T(n)})}};function Dn(t,e){let r=je(t),n=je(e);if(t===e)return{valid:!0,data:t};if(r===g.object&&n===g.object){let s=P.objectKeys(e),i=P.objectKeys(t).filter(c=>s.indexOf(c)!==-1),o={...t,...e};for(let c of i){let h=Dn(t[c],e[c]);if(!h.valid)return{valid:!1};o[c]=h.data}return{valid:!0,data:o}}else if(r===g.array&&n===g.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<t.length;i++){let o=t[i],c=e[i],h=Dn(o,c);if(!h.valid)return{valid:!1};s.push(h.data)}return{valid:!0,data:s}}else return r===g.date&&n===g.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var nt=class extends R{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),s=(i,o)=>{if(Ws(i)||Ws(o))return x;let c=Dn(i.value,o.value);return c.valid?((Bs(i)||Bs(o))&&r.dirty(),{status:r.value,value:c.data}):(m(n,{code:f.invalid_intersection_types}),x)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};nt.create=(t,e,r)=>new nt({left:t,right:e,typeName:k.ZodIntersection,...T(r)});var be=class t extends R{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==g.array)return m(n,{code:f.invalid_type,expected:g.array,received:n.parsedType}),x;if(n.data.length<this._def.items.length)return m(n,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),x;!this._def.rest&&n.data.length>this._def.items.length&&(m(n,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let i=[...n.data].map((o,c)=>{let h=this._def.items[c]||this._def.rest;return h?h._parse(new ue(n,o,n.path,c)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>X.mergeArray(r,o)):X.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};be.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new be({items:t,typeName:k.ZodTuple,rest:null,...T(e)})};var Zn=class t extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==g.object)return m(n,{code:f.invalid_type,expected:g.object,received:n.parsedType}),x;let s=[],i=this._def.keyType,o=this._def.valueType;for(let c in n.data)s.push({key:i._parse(new ue(n,c,n.path,c)),value:o._parse(new ue(n,n.data[c],n.path,c)),alwaysSet:c in n.data});return n.common.async?X.mergeObjectAsync(r,s):X.mergeObjectSync(r,s)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof R?new t({keyType:e,valueType:r,typeName:k.ZodRecord,...T(n)}):new t({keyType:Ke.create(),valueType:e,typeName:k.ZodRecord,...T(r)})}},It=class extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==g.map)return m(n,{code:f.invalid_type,expected:g.map,received:n.parsedType}),x;let s=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([c,h],l)=>({key:s._parse(new ue(n,c,n.path,[l,"key"])),value:i._parse(new ue(n,h,n.path,[l,"value"]))}));if(n.common.async){let c=new Map;return Promise.resolve().then(async()=>{for(let h of o){let l=await h.key,y=await h.value;if(l.status==="aborted"||y.status==="aborted")return x;(l.status==="dirty"||y.status==="dirty")&&r.dirty(),c.set(l.value,y.value)}return{status:r.value,value:c}})}else{let c=new Map;for(let h of o){let l=h.key,y=h.value;if(l.status==="aborted"||y.status==="aborted")return x;(l.status==="dirty"||y.status==="dirty")&&r.dirty(),c.set(l.value,y.value)}return{status:r.value,value:c}}}};It.create=(t,e,r)=>new It({valueType:e,keyType:t,typeName:k.ZodMap,...T(r)});var Lt=class t extends R{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==g.set)return m(n,{code:f.invalid_type,expected:g.set,received:n.parsedType}),x;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(m(n,{code:f.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(m(n,{code:f.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());let i=this._def.valueType;function o(h){let l=new Set;for(let y of h){if(y.status==="aborted")return x;y.status==="dirty"&&r.dirty(),l.add(y.value)}return{status:r.value,value:l}}let c=[...n.data.values()].map((h,l)=>i._parse(new ue(n,h,n.path,l)));return n.common.async?Promise.all(c).then(h=>o(h)):o(c)}min(e,r){return new t({...this._def,minSize:{value:e,message:b.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:b.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Lt.create=(t,e)=>new Lt({valueType:t,minSize:null,maxSize:null,typeName:k.ZodSet,...T(e)});var Wn=class t extends R{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==g.function)return m(r,{code:f.invalid_type,expected:g.function,received:r.parsedType}),x;function n(c,h){return qn({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ln(),Et].filter(l=>!!l),issueData:{code:f.invalid_arguments,argumentsError:h}})}function s(c,h){return qn({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ln(),Et].filter(l=>!!l),issueData:{code:f.invalid_return_type,returnTypeError:h}})}let i={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof Le){let c=this;return ee(async function(...h){let l=new ce([]),y=await c._def.args.parseAsync(h,i).catch(F=>{throw l.addIssue(n(h,F)),l}),M=await Reflect.apply(o,this,y);return await c._def.returns._def.type.parseAsync(M,i).catch(F=>{throw l.addIssue(s(M,F)),l})})}else{let c=this;return ee(function(...h){let l=c._def.args.safeParse(h,i);if(!l.success)throw new ce([n(h,l.error)]);let y=Reflect.apply(o,this,l.data),M=c._def.returns.safeParse(y,i);if(!M.success)throw new ce([s(y,M.error)]);return M.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:be.create(e).rest(Ne.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||be.create([]).rest(Ne.create()),returns:r||Ne.create(),typeName:k.ZodFunction,...T(n)})}},st=class extends R{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};st.create=(t,e)=>new st({getter:t,typeName:k.ZodLazy,...T(e)});var it=class extends R{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return m(r,{received:r.data,code:f.invalid_literal,expected:this._def.value}),x}return{status:"valid",value:e.data}}get value(){return this._def.value}};it.create=(t,e)=>new it({value:t,typeName:k.ZodLiteral,...T(e)});function Js(t,e){return new at({values:t,typeName:k.ZodEnum,...T(e)})}var at=class t extends R{constructor(){super(...arguments),Rt.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return m(r,{expected:P.joinValues(n),received:r.parsedType,code:f.invalid_type}),x}if(pr(this,Rt,"f")||Us(this,Rt,new Set(this._def.values),"f"),!pr(this,Rt,"f").has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return m(r,{received:r.data,code:f.invalid_enum_value,options:n}),x}return ee(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};Rt=new WeakMap;at.create=Js;var ot=class extends R{constructor(){super(...arguments),St.set(this,void 0)}_parse(e){let r=P.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==g.string&&n.parsedType!==g.number){let s=P.objectValues(r);return m(n,{expected:P.joinValues(s),received:n.parsedType,code:f.invalid_type}),x}if(pr(this,St,"f")||Us(this,St,new Set(P.getValidEnumValues(this._def.values)),"f"),!pr(this,St,"f").has(e.data)){let s=P.objectValues(r);return m(n,{received:n.data,code:f.invalid_enum_value,options:s}),x}return ee(e.data)}get enum(){return this._def.values}};St=new WeakMap;ot.create=(t,e)=>new ot({values:t,typeName:k.ZodNativeEnum,...T(e)});var Le=class extends R{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==g.promise&&r.common.async===!1)return m(r,{code:f.invalid_type,expected:g.promise,received:r.parsedType}),x;let n=r.parsedType===g.promise?r.data:Promise.resolve(r.data);return ee(n.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Le.create=(t,e)=>new Le({type:t,typeName:k.ZodPromise,...T(e)});var he=class extends R{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{m(n,o),o.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let o=s.transform(n.data,i);if(n.common.async)return Promise.resolve(o).then(async c=>{if(r.value==="aborted")return x;let h=await this._def.schema._parseAsync({data:c,path:n.path,parent:n});return h.status==="aborted"?x:h.status==="dirty"||r.value==="dirty"?Tt(h.value):h});{if(r.value==="aborted")return x;let c=this._def.schema._parseSync({data:o,path:n.path,parent:n});return c.status==="aborted"?x:c.status==="dirty"||r.value==="dirty"?Tt(c.value):c}}if(s.type==="refinement"){let o=c=>{let h=s.refinement(c,i);if(n.common.async)return Promise.resolve(h);if(h instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(n.common.async===!1){let c=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return c.status==="aborted"?x:(c.status==="dirty"&&r.dirty(),o(c.value),{status:r.value,value:c.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(c=>c.status==="aborted"?x:(c.status==="dirty"&&r.dirty(),o(c.value).then(()=>({status:r.value,value:c.value}))))}if(s.type==="transform")if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Xe(o))return o;let c=s.transform(o.value,i);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:c}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Xe(o)?Promise.resolve(s.transform(o.value,i)).then(c=>({status:r.value,value:c})):o);P.assertNever(s)}};he.create=(t,e,r)=>new he({schema:t,typeName:k.ZodEffects,effect:e,...T(r)});he.createWithPreprocess=(t,e,r)=>new he({schema:e,effect:{type:"preprocess",transform:t},typeName:k.ZodEffects,...T(r)});var fe=class extends R{_parse(e){return this._getType(e)===g.undefined?ee(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};fe.create=(t,e)=>new fe({innerType:t,typeName:k.ZodOptional,...T(e)});var _e=class extends R{_parse(e){return this._getType(e)===g.null?ee(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_e.create=(t,e)=>new _e({innerType:t,typeName:k.ZodNullable,...T(e)});var ct=class extends R{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===g.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:k.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...T(e)});var ut=class extends R{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return hr(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ce(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ce(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};ut.create=(t,e)=>new ut({innerType:t,typeName:k.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...T(e)});var qt=class extends R{_parse(e){if(this._getType(e)!==g.nan){let n=this._getOrReturnCtx(e);return m(n,{code:f.invalid_type,expected:g.nan,received:n.parsedType}),x}return{status:"valid",value:e.data}}};qt.create=t=>new qt({typeName:k.ZodNaN,...T(t)});var mo=Symbol("zod_brand"),mr=class extends R{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},gr=class t extends R{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?x:i.status==="dirty"?(r.dirty(),Tt(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?x:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:k.ZodPipeline})}},dt=class extends R{_parse(e){let r=this._def.innerType._parse(e),n=s=>(Xe(s)&&(s.value=Object.freeze(s.value)),s);return hr(r)?r.then(s=>n(s)):n(r)}unwrap(){return this._def.innerType}};dt.create=(t,e)=>new dt({innerType:t,typeName:k.ZodReadonly,...T(e)});var go={object:se.lazycreate},k;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(k||(k={}));var qe=Ke.create,qa=Pt.create,yo=qt.create,vo=jt.create,$a=Nt.create,bo=Ot.create,_o=Ct.create,Da=et.create,wo=tt.create,ko=Mt.create,Za=Ne.create,xo=ge.create,zo=At.create,yr=Oe.create,$t=se.create,To=se.strictCreate,Gs=rt.create,Ro=$n.create,So=nt.create,Eo=be.create,Wa=Zn.create,Po=It.create,jo=Lt.create,No=Wn.create,Oo=st.create,Ba=it.create,Co=at.create,Mo=ot.create,Ao=Le.create,Io=he.create,Lo=fe.create,qo=_e.create,$o=he.createWithPreprocess,Do=gr.create;var Zo=Gs([$t({modifiers:yr(qe()),key:qe()}),$t({macOS:$t({modifiers:yr(qe()),key:qe()}),windows:$t({modifiers:yr(qe()),key:qe()})})]);function Qs(t){return t.replace(/[^\\](\\ud800|\ud800|\0)/gi,"")}var Zt=require("node:perf_hooks");var Xs=require("worker_threads");var Ua=[];function vr(){return Ua}var Bn=require("node:crypto"),Ha="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Fa=128,$e,lt;function Ja(t){!$e||$e.length<t?($e=Buffer.allocUnsafe(t*Fa),Bn.webcrypto.getRandomValues($e),lt=0):lt+t>$e.length&&(Bn.webcrypto.getRandomValues($e),lt=0),lt+=t}function Ys(t=21){Ja(t-=0);let e="";for(let r=lt-t;r<lt;r++)e+=Ha[$e[r]&63];return e}var br=class{options;terminationHandler;worker;resultHandlers;timeoutId;lastELU;isHandlingError=!1;loadPromiseRejection;get id(){return this.options.id}constructor(e,r){this.options=e,this.terminationHandler=r,this.resultHandlers=new Map,this.worker=new Xs.Worker(e.workerPath,{workerData:e,stdin:!0,stdout:!0,stderr:!0,resourceLimits:{maxOldGenerationSizeMb:e.maxHeapSizeMb}}),e.timeout&&(this.timeoutId=setTimeout(this.timeout.bind(this),e.timeout*1e3))}load(){this.worker.on("message",async r=>{let{kind:n}=r;switch(n){case"notify":{let{method:s}=r,{params:i}=r;switch(s){case"commandException":{this.isHandlingError=!0;let o=B.tryDeserialize(i)??new B(i,6,"Worker Error",{sessionId:this.id});o.diagnostics||(o.diagnostics=this.diagnostics()),await Dt(o);break}case"captureException":{let o=B.tryDeserialize(i)??new B(i,6,"Worker Error",{sessionId:this.id});o.diagnostics||(o.diagnostics=this.diagnostics()),ei(o);break}default:{we(s,i);break}}}break;case"request":{let{id:s}=r;try{let{method:i}=r,{params:o}=r,c=await Ks(i,{...o,sessionId:this.id,requestId:s});this.worker.postMessage({kind:"result",id:s,result:{success:!0,value:c}})}catch(i){this.worker.postMessage({kind:"result",id:s,result:{success:!1,error:i}})}}break;case"result":{let{id:s}=r,{result:i}=r;this.resultHandlers.get(s)?.(i),this.resultHandlers.delete(s)}break;default:break}}),this.worker.on("messageerror",async r=>{this.isHandlingError=!0;let n=new B(r,5,"Worker Message Error",{breadcrumbs:vr(),diagnostics:this.diagnostics(),sessionId:this.id});await Dt(n)}),this.worker.on("error",async r=>{this.isHandlingError=!0;let n=new B(r,6,"Worker Error",{breadcrumbs:vr(),diagnostics:this.diagnostics(),sessionId:this.id});await Dt(n)}),this.worker.on("exit",r=>{this.removeListeners(),this.terminationHandler?.(this.id),!this.isHandlingError&&we("commandExited",{sessionId:this.id,code:r})});let e=new Promise((r,n)=>{this.loadPromiseRejection=n});return Promise.race([this.request("initialize",{}),e]).finally(()=>{this.loadPromiseRejection=void 0})}async unload(){try{let e,r=new Promise((s,i)=>{e=setTimeout(()=>{this.worker.terminate().then(o=>{s(o)}).catch(o=>i(o))},500)}),n=this.request("terminate",{code:0}).then(()=>(clearTimeout(e),0)).catch(()=>(clearTimeout(e),this.worker.terminate()));return await Promise.race([r,n])}finally{this.removeListeners()}}request(e,r){return new Promise((n,s)=>{let i=Ys(),o=c=>{if(c.success===!1){let h=B.tryDeserialize(c.error)??new B(c.error,8,"Worker Request Error");h.sessionId||(h.sessionId=this.id),h.diagnostics||(h.diagnostics=this.diagnostics()),s(h.serialize());return}n(c.value)};this.resultHandlers.set(i,o),this.worker.postMessage({kind:"request",id:i,method:e,params:r})})}diagnostics(){let e=this.worker.performance.eventLoopUtilization(),r=this.worker.performance.eventLoopUtilization(e,this.lastELU);return this.lastELU=e,{id:this.options.id,extensionName:this.options.extensionName,name:this.options.entryPointName,mode:this.options.entryPointMode,isDevelopment:this.options.isDevelopment,launchType:this.options.launchType,timeout:this.options.timeout,eventLoopUtilization:r,startedAt:this.options.startedAt}}async timeout(){try{this.worker.removeAllListeners("exit"),this.options.entryPointType==="tool"&&this.loadPromiseRejection?this.loadPromiseRejection(new Error(`The execution of ${this.options.entryPointName} timed out (${this.options.timeout}s max).`)):(this.options.isDevelopment&&await we("logCommand",{sessionId:this.id,level:"error",message:`The execution of ${this.options.entryPointName} timed out (${this.options.timeout}s max).`}),await this.worker.terminate())}catch(e){await Dt(new B(e,14,"Worker Timeout Error",{breadcrumbs:vr(),diagnostics:this.diagnostics(),sessionId:this.id}))}finally{this.removeListeners(),this.terminationHandler?.(this.id)}}removeListeners(){this.worker.removeAllListeners("message"),this.worker.removeAllListeners("messageerror"),this.worker.removeAllListeners("error"),this.worker.removeAllListeners("exit"),this.timeoutId&&clearTimeout(this.timeoutId)}};var ht=new Map,ft=new Set;async function _r(t){ft.delete(t.id);let e=new br(t,r=>{ht.delete(r),ft.add(r),setTimeout(()=>{ft.delete(t.id)},1e3)});return ht.set(t.id,e),e.load()}async function ti(t){let e=ht.get(t);if(e)try{return await e.unload()}finally{ht.delete(t),ft.add(t),setTimeout(()=>{ft.delete(t)},1e3)}}async function ri(t,e,r){if(ft.has(t))throw new B(new Error("Worker already terminated"),17,"Race Condition Error",{breadcrumbs:[{level:"fatal",category:"Request",message:"Worker already terminated",timestamp:new Date(Zt.performance.timeOrigin+Zt.performance.now()).toISOString(),data:{method:e,sessionId:t}}],sessionId:t}).serialize();let n=ht.get(t);if(!n)throw new B(new Error("Could not communicate with worker"),11,"Unknown Command",{breadcrumbs:[{level:"fatal",category:"Request",message:"Could not communicate with worker",timestamp:new Date(Zt.performance.timeOrigin+Zt.performance.now()).toISOString(),data:{method:e,sessionId:t}}],sessionId:t}).serialize();return n.request(e,r)}function ni(){return[...ht.values()].map(t=>t.diagnostics())}async function Un(t){return{workerDiagnostics:ni()}}async function Hn(t){return{nodeVersion:process.version}}async function Fn(t){let e=t?.sessionId,r=t?.workerPath,n=t?.ownerOrAuthorName,s=t?.extensionName,i=t?.commandName,o=t?.commandMode,c=t?.commandPath,h=t?.assetsPath,l=t?.supportPath,y=t?.maxHeapSizeMb,M=t?.isDevelopment,Q=t?.appearance,F=t?.textSize,ke=t?.draftValues,ie=t?.launchType,ae=t?.timeout,xe=t?.startedAt;if(!e||!r||typeof n>"u"||!s||!i||!o||!c||!h||!l||!y||!Q||!F||!ie)return Promise.reject(new Error(`Invalid parameters ${t}`));let te=t?.preferences,N=t?.arguments,de=t?.launchContext,q=t?.fallbackText,oe=t?.canAccessAI,Ce=t?.canAccessBetterAIModels,gt=t?.isBrowserExtensionInstalled,Bt=t?.canAccessWindowManagement,Vt=t?.namedExport;return await _r({entryPointType:"command",id:e,workerPath:r,ownerOrAuthorName:n,extensionName:s,entryPointName:i,entryPointMode:o,commandPath:c,assetsPath:h,supportPath:l,preferences:te,maxHeapSizeMb:y,isDevelopment:M,appearance:Q,textSize:F,draftValues:ke,argumentValues:N,launchType:ie,timeout:ae,startedAt:xe,launchContext:de,fallbackText:q,canAccessAI:oe,canAccessBetterAIModels:Ce,isBrowserExtensionInstalled:gt,canAccessWindowManagement:Bt,namedExport:Vt})}async function Jn(t){let e=t?.sessionId,r=t?.workerPath,n=t?.ownerOrAuthorName,s=t?.extensionName,i=t?.toolName,o=t?.toolMode,c=t?.toolPath,h=t?.shouldExecuteFunctionsBeforeReturning,l=t?.assetsPath,y=t?.supportPath,M=t?.maxHeapSizeMb,Q=t?.isDevelopment,F=t?.appearance,ke=t?.textSize,ie=t?.timeout,ae=t?.startedAt;if(!e||!r||typeof n>"u"||!s||!l||!y||!M||!F||!ke)return Promise.reject(new Error(`Invalid parameters ${t}`));let xe=t?.preferences,te=t?.canAccessAI,N=t?.canAccessBetterAIModels,de=t?.isBrowserExtensionInstalled,q=t?.canAccessWindowManagement,oe=t?.arguments,Ce=t?.namedExport;return await _r({entryPointType:"tool",id:e,workerPath:r,ownerOrAuthorName:n,extensionName:s,entryPointName:i,entryPointMode:o,toolPath:c,shouldExecuteFunctionsBeforeReturning:h,assetsPath:l,supportPath:y,preferences:xe,maxHeapSizeMb:M,isDevelopment:Q,appearance:F,textSize:ke,timeout:ie,startedAt:ae,canAccessAI:te,canAccessBetterAIModels:N,isBrowserExtensionInstalled:de,canAccessWindowManagement:q,launchType:"userInitiated",arguments:oe,namedExport:Ce})}async function Gn(t){let e=t?.sessionId;if(!e)throw new B("Native callback called without a session ID ",7,"Invalid Parameters").serialize();return await ri(e,"nativeCallback",t)}async function Qn(t){let e=t?.sessionId;return e?await ti(e):Promise.reject(new Error("Invalid parameters"))}var si=require("node:worker_threads"),ii=require("node:path"),pe=pt.createMessageConnection(new pt.StreamMessageReader(process.stdin),new pt.StreamMessageWriter(process.stdout));pe.onRequest("initialize",t=>mt(Hn,t));pe.onRequest("loadCommand",t=>mt(Fn,t));pe.onRequest("loadTool",t=>mt(Jn,t));pe.onRequest("unloadEntryPoint",t=>mt(Qn,t));pe.onRequest("nativeCallback",t=>mt(Gn,t));pe.onRequest("diagnostics",t=>mt(Un,t));pe.onClose(()=>{process.exit(0)});pe.onError(t=>{let e=`Server connection error: ${t}`;process.stderr.write(`${e}
`),process.exit(1)});function ai(){pe.listen()}function Ks(t,e){return pe.sendRequest(t,wr(e))}function we(t,e){return pe.sendNotification(t,wr(e))}async function Dt(t){let e=await Yn(t);await we("commandException",e),we("commandExited",{sessionId:e.sessionId,code:e.code})}async function ei(t){let e=await Yn(t);await we("captureException",e)}function wr(t){return Object.entries(t).reduce((e,[r,n])=>(e[r]=typeof n=="string"?Qs(n):n,e),{})}var mt=async(t,e)=>{try{return await t(e)}catch(r){let n=B.tryDeserialize(r)??new B(r,8,"Worker Request Error");n.sessionId||(n.sessionId=e.sessionId);let s=wr(n.serialize());try{s=await Yn(n)}catch{}throw new Error(JSON.stringify(wr(s)))}},Yn=t=>new Promise((e,r)=>{if(typeof t.message>"u"||!t.stack)return e(t.serialize());let n=new si.Worker((0,ii.join)(__dirname,"..","source-mapper","index.js"),{workerData:{id:t.sessionId,message:t.message,stack:t.stack},stdin:!0,stdout:!0,stderr:!0,resourceLimits:{maxOldGenerationSizeMb:100}}),s=setTimeout(async()=>{n.removeAllListeners(),await n.terminate(),r(new Error("Source Map worker timed out after 10 seconds"))},10*1e3);n.on("message",i=>{clearTimeout(s),e({...t.serialize(),message:i.message,stack:i.stack})}),n.on("error",i=>{clearTimeout(s),r(i)}),n.on("messageerror",i=>{clearTimeout(s),r(i)}),n.on("exit",()=>{clearTimeout(s)})});function ci(){console.log=Wt("debug"),console.dir=console.log,console.debug=Wt("debug"),console.info=Wt("info"),console.warn=Wt("warn"),console.error=Wt("error")}function Wt(t){return function(e,...r){try{let n=(0,oi.formatWithOptions)({showHidden:!1},e,...r);we("log",{level:t,message:n})}catch{process.stderr.write("Failed logging message: "+String(e)+", params: "+String(r))}}}process.title="Raycast Helper (Extensions)";process.on("uncaughtException",t=>{let e=`uncaughtException: ${t}`;process.stderr.write(`${e}
`),process.exit(1)});process.on("unhandledRejection",(t,e)=>{let r=`unhandledRejection: ${t}`;process.stderr.write(`${r}
`),process.exit(1)});ci();ai();
